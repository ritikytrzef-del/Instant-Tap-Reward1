<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instant Tap Reward</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;padding:0;background:#fffbf0;font-family:Segoe UI,sans-serif;overflow-x:hidden}
    #top{position:fixed;top:0;left:0;right:0;background:white;padding:16px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 20px rgba(0,0,0,0.1);z-index:99}
    #pointBox{background:#e8f5e8;color:#2e7d32;padding:10px 20px;border-radius:30px;font-weight:bold;font-size:17px}
    #walletBtn{background:#2e7d32;color:white;padding:12px 24px;border-radius:30px;font-weight:bold;cursor:pointer}

    /* ==================== SUPER ATTRACTIVE TAP AREA ==================== */
    #tapArea{
      width:330px;
      height:330px;
      margin:100px auto 30px;
      position:relative;
      background:linear-gradient(135deg, #ff6b00, #ff1744, #d500f9);
      border-radius:50%;
      box-shadow:0 30px 90px rgba(255, 40, 100, 0.5), inset 0 0 80px rgba(255,255,255,0.3);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      border:8px solid rgba(255,255,255,0.4);
      animation:pulse 3s infinite ease-in-out;
    }

    #tapArea::before{
      content:'';
      position:absolute;
      top:-50%; left:-50%;
      width:200%; height:200%;
      background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
      transform:rotate(30deg);
      animation:shine 5s infinite;
    }

    .tap-main-text{
      color:white;
      font-size:48px;
      font-weight:900;
      text-align:center;
      letter-spacing:3px;
      text-shadow:0 5px 20px rgba(0,0,0,0.7);
      z-index:2;
    }

    .tap-sub-text{
      color:white;
      font-size:26px;
      font-weight:700;
      margin-top:6px;
      opacity:0.95;
      text-shadow:0 3px 10px rgba(0,0,0,0.6);
    }

    #tapCount{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      font-size:82px;
      font-weight:900;
      color:white;
      text-shadow:0 6px 25px rgba(0,0,0,0.8);
      z-index:3;
      pointer-events:none;
    }

    @keyframes pulse{
      0%,100% {transform:scale(1); box-shadow:0 30px 90px rgba(255,40,100,0.5)}
      50% {transform:scale(1.07); box-shadow:0 40px 120px rgba(255,40,100,0.7)}
    }

    @keyframes shine{
      0% {transform:translateX(-100%) translateY(-100%) rotate(30deg)}
      50% {transform:translateX(100%) translateY(100%) rotate(30deg)}
      100% {transform:translateX(-100%) translateY(-100%) rotate(30deg)}
    }
    /* ================================================================= */

    .plus{position:absolute;font-size:50px;color:#ff1744;font-weight:900;pointer-events:none;animation:fly 1s forwards;z-index:10}
    @keyframes fly{to{transform:translateY(-200px) scale(0.4);opacity:0}}

    #energyBar{width:90%;max-width:420px;height:34px;background:#e0e0e0;border-radius:17px;margin:20px auto;overflow:hidden;border:4px solid #c8e6c9}
    #energyFill{height:100%;background:linear-gradient(90deg,#00e676,#69f0ae);transition:width 0.4s ease}
    #energyText{text-align:center;font-weight:bold;color:#2e7d32;margin-top:8px;font-size:18px}
    #adBtn{background:#ff5722;color:white;padding:18px 40px;border-radius:30px;font-weight:bold;margin:30px auto;display:block;width:90%;max-width:420px;font-size:18px;box-shadow:0 8px 20px rgba(255,87,34,0.4);cursor:pointer}

    .screen{position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:999;padding:20px;box-sizing:border-box;display:none;overflow-y:auto}
    .close{position:absolute;top:15px;right:15px;background:#ddd;width:44px;height:44px;border-radius:50%;border:none;font-size:28px;cursor:pointer}
    .tab-btn{display:inline-block;padding:12px 24px;margin:5px;background:#eee;border-radius:12px;font-weight:bold;cursor:pointer}
    .tab-btn.active{background:#2e7d32;color:white}
    .voucher-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:30px}
    .voucher{background:white;border-radius:24px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.15);text-align:center;position:relative}
    .voucher.locked{opacity:0.65}
    .v-header{background:#212121;padding:20px 0}
    .v-header img{height:48px}
    .v-header span{display:block;color:white;font-size:18px;font-weight:bold;margin-top:8px}
    .v-body{padding:20px}
    .amount{font-size:42px;font-weight:900;color:#000;margin:10px 0}
    .progress{height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:15px 0}
    .progress-fill{height:100%;background:#00bcd4;transition:all 0.5s}
    .progress-text{font-size:14px;color:#666}
    .redeem-btn{background:#ccc;color:white;padding:14px;border:none;border-radius:12px;width:100%;font-size:18px;font-weight:bold;margin-top:15px;cursor:not-allowed}
    .redeem-btn.active{background:#00bcd4;cursor:pointer}
    .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal-content{background:white;padding:30px;border-radius:20px;width:90%;max-width:400px;text-align:center}
    .modal input{width:100%;padding:16px;margin:12px 0;border-radius:12px;border:2px solid #ddd;font-size:18px}
    .modal button{background:#00bcd4;color:white;padding:16px;border:none;border-radius:12px;width:100%;font-size:18px;margin-top:10px;cursor:pointer}
    .history-item{background:#f9f9f9;padding:16px;margin:12px 0;border-radius:16px;border-left:5px solid #ff9800}
    .history-item.success{border-left-color:#2e7d32;background:#e8f5e8}
    .timer{font-weight:bold;color:#d32f2f;font-size:20px}
    .success-text{color:#2e7d32;font-weight:bold;font-size:18px}
  </style>
</head>
<body>

  <div id="top">
    <div><span id="name">Guest</span></div>
    <div id="pointBox">Points: <span id="point">0</span></div>
    <button id="walletBtn" onclick="openWallet()">Wallet</button>
  </div>

  <!-- NEW ATTRACTIVE TAP AREA (No Image) -->
  <div id="tapArea" onclick="tap(event)">
    <div class="tap-main-text">TAP AND</div>
    <div class="tap-sub-text">EARN</div>
    <div id="tapCount">0</div>
  </div>
  <div id="float"></div>

  <div id="energyBar"><div id="energyFill"></div></div>
  <div id="energyText">Energy: <span id="energyNow">10</span>/10</div>
  <button id="adBtn" onclick="watchAd()">Watch Ad & Recharge</button>

  <!-- Start Screen -->
  <div id="startScreen" class="screen" style="display:block;background:#fffbf0;padding-top:150px;text-align:center">
    <h1 style="font-size:48px;color:#1976d2">Instant Tap Reward</h1>
    <p style="font-size:22px;color:#555;margin:40px 0">Tap & Earn Google Play Gift Code!</p>
    <button onclick="startGame()" style="background:#4285f4;color:white;padding:22px 60px;border-radius:30px;font-size:24px;border:none;cursor:pointer">START TAPPING</button>
  </div>

  <!-- Wallet Screen -->
  <div id="walletScreen" class="screen">
    <button class="close" onclick="closeAll()">X</button>
    <h1 style="text-align:center;margin:50px 0 10px;font-size:28px">Available Voucher</h1>
    <h2 style="text-align:center;color:#333;margin-bottom:30px">Points: <span id="wPoint">0</span></h2>

    <div style="text-align:center;margin-bottom:20px">
      <button class="tab-btn active" onclick="showTab('google')">Google Play</button>
      <button class="tab-btn" onclick="showTab('ltc')">Litecoin</button>
      <button class="tab-btn" onclick="showTab('history')">History</button>
    </div>

    <div id="googleTab">
      <div class="voucher-grid" id="vouchers"></div>
    </div>

    <div id="ltcTab" style="display:none">
      <div style="background:#f8f9fa;padding:30px;border-radius:20px;text-align:center">
        <h2>Litecoin Withdrawal</h2>
        <p>320 Points = $0.1 LTC</p>
        <input type="text" id="ltcAddr" placeholder="Enter LTC Address">
        <button onclick="withdrawLTC()" style="background:#ff6d00;color:white;padding:18px;border:none;border-radius:16px;width:100%;font-size:20px;font-weight:bold;margin-top:15px;cursor:pointer">Withdraw $0.1</button>
      </div>
    </div>

    <div id="historyTab" style="display:none;margin-top:20px">
      <h3 style="text-align:center">Withdrawal History</h3>
      <div id="historyList"><p style="text-align:center;color:#666">No history yet</p></div>
    </div>
  </div>

  <!-- Redeem Modal -->
  <div class="modal" id="redeemModal">
    <div class="modal-content">
      <h2>Redeem Google Play Code</h2>
      <input type="text" id="redeemName" placeholder="Full Name">
      <input type="email" id="redeemEmail" placeholder="Gmail Address">
      <button onclick="submitRedeem()">Submit Request</button>
      <button onclick="document.getElementById('redeemModal').style.display='none'" style="background:#999;margin-top:8px">Cancel</button>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    const BOT_TOKEN = "8510745729:AAHIr4lQiAeWoxBLq7QA7PyHcG3jaBZDcZQ";
    const CHANNEL_ID = "@Instanttapreward";

    const user = Telegram.WebApp.initDataUnsafe.user || {};
    const userId = user.id ? user.id.toString() : "guest"+Date.now();
    const userName = user.first_name || user.username || "Guest";
    document.getElementById("name").textContent = userName;

    const S = "point_"+userId;
    let points = parseInt(localStorage.getItem(S)) || 0;
    let energy = 10;
    let playing = false;
    let selectedINR = 0;

    const vouchers = [
      { inr: 10, points: 320 },
      { inr: 20, points: 640 },
      { inr: 50, points: 1600 },
      { inr: 100, points: 3200 }
    ];

    function sendToChannel(text) {
      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHANNEL_ID, text: text, parse_mode: "HTML" })
      });
    }

    function formatTime(sec) {
      const h = String(Math.floor(sec / 3600)).padStart(2, '0');
      const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
      const s = String(sec % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    function updateHistory() {
      let requests = JSON.parse(localStorage.getItem("withdraw_requests") || "[]");
      const now = Date.now();
      const twelveHours = 12 * 60 * 60 * 1000;
      let html = "";

      requests = requests.map(r => {
        if (r.userId === userId && r.status === "pending" && (now - r.time) >= twelveHours) {
          r.status = "success";
        }
        return r;
      });
      localStorage.setItem("withdraw_requests", JSON.stringify(requests));

      const userReqs = requests.filter(r => r.userId === userId).reverse();

      if (userReqs.length === 0) {
        html = "<p style='text-align:center;color:#666'>No withdrawal history yet</p>";
      } else {
        userReqs.forEach(r => {
          const elapsed = Math.floor((now - r.time) / 1000);
          const remaining = Math.max(0, 43200 - elapsed);
          const isSuccess = r.status === "success";

          html += `
            <div class="history-item ${isSuccess ? 'success' : ''}">
              <b>${r.type}</b><br>
              ${r.details}<br>
              <small>${new Date(r.time).toLocaleString("en-IN")}</small><br>
              ${isSuccess ? '<span class="success-text">Success</span>' : `<span class="timer">${formatTime(remaining)}</span>`}
            </div>`;
        });
      }
      document.getElementById("historyList").innerHTML = html;
    }

    function update() {
      document.getElementById("point").textContent = points.toLocaleString();
      document.getElementById("wPoint").textContent = points.toLocaleString();
      document.getElementById("tapCount").textContent = points.toLocaleString();
      document.getElementById("energyFill").style.width = (energy/10)*100 + "%";
      document.getElementById("energyNow").textContent = energy;
      loadVouchers();
    }

    function loadVouchers() {
      let html = "";
      vouchers.forEach(v => {
        const progress = Math.min((points / v.points) * 100, 100);
        const unlocked = points >= v.points;
        html += `
          <div class="voucher ${unlocked ? '' : 'locked'}">
            <div class="v-header">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Google_Play_Store_badge_EN.svg/512px-Google_Play_Store_badge_EN.svg.png">
              <span>Google Play</span>
            </div>
            <div class="v-body">
              <div class="amount">₹${v.inr}</div>
              <div class="progress"><div class="progress-fill" style="width:${progress}%"></div></div>
              <div class="progress-text">${points.toLocaleString()} / ${v.points.toLocaleString()} pts</div>
              <button class="redeem-btn ${unlocked ? 'active' : ''}" ${unlocked ? `onclick="openRedeem(${v.inr})"` : 'disabled'}>
                ${unlocked ? 'Redeem Now' : 'Locked'}
              </button>
            </div>
          </div>`;
      });
      document.getElementById("vouchers").innerHTML = html;
    }

    function openRedeem(inr) {
      selectedINR = inr;
      document.getElementById("redeemModal").style.display = "flex";
    }

    function submitRedeem() {
      const name = document.getElementById("redeemName").value.trim();
      const email = document.getElementById("redeemEmail").value.trim();
      if (!name || !email.includes("@gmail.com")) return Telegram.WebApp.showAlert("Valid Name & Gmail daal do!");

      const deduct = selectedINR === 10 ? 320 : selectedINR === 20 ? 640 : selectedINR === 50 ? 1600 : 3200;
      if (points < deduct) return Telegram.WebApp.showAlert("Points kam hain!");

      points -= deduct;
      localStorage.setItem(S, points);

      const msg = `<b>New Google Play Request</b>\n\nUser ID: <code>${userId}</code>\nName: ${name}\nEmail: ${email}\nAmount: ₹${selectedINR}\nTime: ${new Date().toLocaleString()}`;
      sendToChannel(msg);

      const req = { userId, type: `Google Play ₹${selectedINR}`, details: `${name} | ${email}`, time: Date.now(), status: "pending" };
      let requests = JSON.parse(localStorage.getItem("withdraw_requests") || "[]");
      requests.push(req);
      localStorage.setItem("withdraw_requests", JSON.stringify(requests));

      document.getElementById("redeemModal").style.display = "none";
      Telegram.WebApp.showAlert(`₹${selectedINR} request successful!\n12 hours mein code milega`);
      update();
    }

    function withdrawLTC() {
      if (points < 320) return Telegram.WebApp.showAlert("320 Points chahiye!");
      const addr = document.getElementById("ltcAddr").value.trim();
      if (!addr || addr.length < 25) return Telegram.WebApp.showAlert("Valid LTC address daal do!");

      points -= 320;
      localStorage.setItem(S, points);

      const msg = `<b>New LTC Request</b>\n\nUser ID: <code>${userId}</code>\nName: ${userName}\nAddress: <code>${addr}</code>\nAmount: $0.1\nTime: ${new Date().toLocaleString()}`;
      sendToChannel(msg);

      const req = { userId, type: "LTC $0.1", details: addr, time: Date.now(), status: "pending" };
      let requests = JSON.parse(localStorage.getItem("withdraw_requests") || "[]");
      requests.push(req);
      localStorage.setItem("withdraw_requests", JSON.stringify(requests));

      Telegram.WebApp.showAlert("$0.1 LTC request successful!\n12 hours mein payment hoga");
      update();
    }

    function showTab(tab) {
      document.getElementById("googleTab").style.display = tab === "google" ? "block" : "none";
      document.getElementById("ltcTab").style.display = tab === "ltc" ? "block" : "none";
      document.getElementById("historyTab").style.display = tab === "history" ? "block" : "none";
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      event.target.classList.add("active");
      if (tab === "history") updateHistory();
    }

    function tap(e) {
      if (!playing || energy <= 0) return;
      energy--; points++; localStorage.setItem(S, points);
      const plus = document.createElement("div");
      plus.className = "plus";
      plus.textContent = "+1";
      plus.style.left = (e.touches?.[0].clientX || e.clientX - 20) + "px";
      plus.style.top = (e.touches?.[0].clientY || e.clientY - 20) + "px";
      document.getElementById("float").appendChild(plus);
      setTimeout(() => plus.remove(), 1000);
      Telegram.WebApp.HapticFeedback.impactOccurred("medium");
      update();
    }

    function watchAd() { 
      energy = 10; 
      update(); 
      Telegram.WebApp.showAlert("Energy Full! Ab tap karo!"); 
    }

    function startGame() { 
      document.getElementById("startScreen").style.display = "none"; 
      playing = true; 
      update(); 
    }

    function openWallet() { 
      closeAll(); 
      document.getElementById("walletScreen").style.display = "block"; 
      update(); 
    }

    function closeAll() { 
      document.querySelectorAll(".screen").forEach(s => s.style.display = "none"); 
    }

    setInterval(() => {
      if (document.getElementById("historyTab") && document.getElementById("historyTab").style.display === "block") {
        updateHistory();
      }
    }, 1000);

    update();
  </script>
</body>
</html>
